#### Federated Identity ####
> A [federated identity](https://en.wikipedia.org/wiki/Federated_identity) in information technology is the means of linking a person's electronic identity and attributes, stored across multiple distinct identity management systems.
> 
> Related to federated identity is single sign-on (SSO), in which a user's single authentication ticket, or token, is trusted across multiple IT systems or even organizations. SSO is a subset of federated identity management, as it relates only to authentication and is understood on the level of technical interoperability

> Federated Identity started with the need to support application access that spans beyond a company or organization boundary. Imagine a relationship between a juice company (JuiceCo) selling its product to a large supermarket chain (BigMart). As an employee of JuiceCo, you need to access an application provided by BigMart to manage the relationship and monitor supplies and sales.
>
> In this case, BigMart (who is providing this application) will need to take care of user authentication. The simple way is to require a different user name and password from users working at JuiceCo. But think about all the users that this application will need to maintain – including all of the other suppliers and their users who need to access the application.
>
> A more elegant way to solve this problem is to allow JuiceCo and every other supplier to share or “federate” the identities with BigMart. As an employee of JuiceCo, you already have a corporate identity and credentials. What Federated Identity provides is a secure way for the supermarket chain (Service Provider) to externalize authentication by integrating with its suppliers’ existing identity infrastructure (Identity Provider). This type of use case is what led to the birth of
federated protocols such as [Secure Assertion Markup Languange SAML](http://en.wikipedia.org/wiki/Security_Assertion_Markup_Language).
>
> See [Security Assertion Markup Language (SAML) V2.0 Technical Overview](http://docs.oasis-open.org/security/saml/Post2.0/sstc-saml-tech-overview-2.0.html)for a in-depth overview.

#### [SAML Authentication flow](http://developer.okta.com/docs/guides/saml_guidance.html) ####
SAML is mostly used as a web-based authentication mechanism inasmuch as it relies on using the browser agent to broker the authentication flow. At a high-level, the authentication flow of SAML looks like this:
![saml_auth_flow](http://developer.okta.com/assets/img/saml_guidance_saml_flow.png)

We are now ready to introduce some common SAML terms. We will go into the technical details of these later – but it is important to :qunderstand the high-level concept during the planning stage.

- A Service Provider (SP) is the entity providing the service – typically in the form of an application
- An Identity Provider (IDP) is the entity providing the identities, including the ability to authenticate a user. The Identity Provider typically also contains the user profile – additional information about the user such as first name, last name, job code, phone number, address, etc. Depending on the application, some service providers may require a very simple profile (username, email), while others may require a richer set of user data (job code, department, address,
  location, manager, etc).
- A SAML Request, also known as an authentication request, is generated by the Service Provider to “request” an authentication.
- A SAML Response is generated by the Identity Provider. It contains the actual assertion of the authenticated usker. In addition, a SAML Response may contain additional information, such as user profile informatkion and group/role information, depending on what the Service Provider can support.
- Service Provider Initiated (SP-initiated) login describes the SAML login flow when initiated by the Service Provider. This is typically triggered when the end user tries to access a resource or login directly on tjhe Service Provider side, such as when the browser tries to access a protected resource on the Service Provider side.
- An Identity Provider Initiated (IDP-initiated) login describes the SAML login flow initiated by the Identity Provider. Instead of the SAML flow being triggered by a redirection from the Service Provider, in this flow the Identity Provider initiates a SAML Response that is redirected to the Service Provider to assert the user’s identity.

A couple of key things to note:

1. The Service Provider never directly interacts with the Identity Provider. A browser acts as the agent to carry out all the redirections.

2. The Service Provider needs to know which Identity Provider to redirect to before it has any idea who the user is.

3. The Service Provider does not know who the user is until the SAML assertion comes back from the Identity Provider.

4. This flow does not have to start from the Service Provider. An Identity Provider can initiate an authentication flow.

5. The SAML authentication flow is asynchronous. The Service Provider does not know if the Identity Provider will ever complete the entire flow. Because of this, the Service Provider does not maintain any state of any authentication requests generated. When the Service Provider receives a response from an Identity Provider, the response must contain all the necessary information.

- RelayState
    > **BACKGROUND**: 
    
    > SAML is an asynchronous protocol by design. The SP-initiated login begins the flow by generating a SAML Authentication Request that gets redirected to the IDP. 
    > At this point, the SP does not store any information about the request. When the SAML response comes back from the IDP, the SP wouldn’t know anything about 
    > the initial deep-link that triggered the authentication request. Luckily, 
    
    > **Solution**: SAML supports this with a parameter called **RelayState**.
    > A RelayState is an HTTP parameter that can be included as part of the SAML request and SAML response. 
    > In an SP-initiated login flow, the SP can set the RelayState parameter in the SAML request with additional information about the request. 
    > A SAML IDP, upon receiving the SAML request, will take the RelayState value and simply attach it back as a HTTP parameter in the SAML response after the user has been authenticated. 
    > This way, when the round trip completes, the SP can use the RelayState information to get additional context about the initial SAML authentication request.

    > In the case of a deeplink, the SP will set the RelayState of the SAML request with the deep-link value. 
    > When the SAML response comes back, the SP can use the RelayState value and take the authenticated user to the right resource. Here is an example of the flow.

    > Please find below flow :
    > ![relay_state_flow](http://developer.okta.com/assets/img/saml_guidance_deeplink.png)



#### SAML Refs ####
- SAML 2.0:
    - [Assertions and Protocols for the OASIS Security Assertion Markup Language (SAML) V2.0](http://docs.oasis-open.org/security/saml/v2.0/saml-core-2.0-os.pdf)
    - [Bindings for the OASIS Security Assertion Markup Language (SAML) V2.0](http://docs.oasis-open.org/security/saml/v2.0/saml-bindings-2.0-os.pdf)
    - [Profiles for the OASIS Security Assertion Markup Language (SAML) V2.0](http://docs.oasis-open.org/security/saml/v2.0/saml-profiles-2.0-os.pdf)
- SAML Toolkits
    - Java: [OpenSAML](https://shibboleth.net/products/opensaml-java.html)
    - Python: [PySAML2](http://developer.okta.com/docs/guides/pysaml2.html)
    - Testing SAML: [Okta SAML validation tool](http://saml.oktadev.com/)
